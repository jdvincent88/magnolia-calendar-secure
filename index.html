<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendar</title>

  <!-- FullCalendar view CSS (core has no CSS in v6) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.15/index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.15/index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/list@6.1.15/index.css">

  <style>
    html, body { margin: 0; padding: 0; font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    .wrap { max-width: 1100px; margin: 24px auto; padding: 0 12px; }
    #calendar { background:#fff; border:1px solid #ddd; border-radius:12px; padding:8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:0 0 12px; font-size:22px;">Events Calendar</h1>
    <div id="calendar"></div>
  </div>

  <!-- FullCalendar globals bundle (auto-registers plugins) -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const el = document.getElementById('calendar');
      const calendar = new FullCalendar.Calendar(el, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
        },
        height: 'auto'
        // events: [] // we’ll wire this to your function later
      });
      calendar.render();
    });
  </script>

  <!-- ===== ADMIN UI (appears only with ?admin=1) ===== -->
  <style>
    #adminBtn{display:none;position:fixed;bottom:16px;right:16px;padding:10px 14px;border-radius:8px;border:1px solid #999;background:#fff}
    #adminModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);align-items:center;justify-content:center}
    #adminCard{background:#fff;max-width:520px;width:92%;padding:16px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    #adminCard label{display:block;margin:.6rem 0 .2rem}
    #adminCard input,#adminCard textarea{width:100%;padding:8px;border:1px solid #ccc;border-radius:8px}
    #adminCard .row{display:flex;gap:8px}
    #adminCard .row > div{flex:1}
  </style>

  <button id="adminBtn">➕ Add Event</button>
  <div id="adminModal">
    <div id="adminCard">
      <h3 style="margin:0 0 8px">Add Event</h3>
      <label>Title</label>
      <input id="evTitle" placeholder="Event title" />
      <div class="row">
        <div>
          <label>Start</label>
          <input id="evStart" type="datetime-local" />
        </div>
        <div>
          <label>End</label>
          <input id="evEnd" type="datetime-local" />
        </div>
      </div>
      <label>Location</label>
      <input id="evLoc" placeholder="(optional)" />
      <label>Description</label>
      <textarea id="evDesc" rows="3" placeholder="(optional)"></textarea>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button id="adminCancel">Cancel</button>
        <button id="adminSave">Save</button>
      </div>
      <div id="adminMsg" style="margin-top:8px; font-size:12px; color:#444;"></div>
    </div>
  </div>

  <script>
    (function(){
      const params = new URLSearchParams(location.search);
      const isAdmin = params.get('admin') === '1';
      const btn = document.getElementById('adminBtn');
      const modal = document.getElementById('adminModal');
      const msg = document.getElementById('adminMsg');

      if (isAdmin) btn.style.display = 'block';

      btn?.addEventListener('click', ()=>{ modal.style.display='flex'; msg.textContent=''; });
      document.getElementById('adminCancel').addEventListener('click', ()=>{ modal.style.display='none'; });

      document.getElementById('adminSave').addEventListener('click', async ()=>{
        msg.textContent = 'Saving...';
        const title = document.getElementById('evTitle').value.trim();
        const start = document.getElementById('evStart').value;
        const end   = document.getElementById('evEnd').value;
        const location = document.getElementById('evLoc').value.trim();
        const description = document.getElementById('evDesc').value.trim();

        if (!title || !start || !end) { msg.textContent = 'Title, start and end are required.'; return; }

        // Convert local time to ISO. This will hit your Netlify function once we add it.
        const payload = {
          title,
          start: new Date(start).toISOString(),
          end:   new Date(end).toISOString(),
          location,
          description
        };

        try {
          const r = await fetch('/.netlify/functions/create-event', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify(payload)
          });
          const data = await r.json().catch(()=> ({}));
          if (r.ok && data.ok) {
            msg.textContent = 'Event created ✔';
            setTimeout(()=>{ modal.style.display='none'; location.reload(); }, 600);
          } else {
            msg.textContent = 'Save failed (backend not set up yet): ' + (data.error || r.statusText);
          }
        } catch (e) {
          msg.textContent = 'Network error: ' + String(e);
        }
      });
    })();
  </script>
  <!-- ===== /ADMIN UI ===== -->

</body>
</html>